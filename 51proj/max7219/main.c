#include <reg52.h>
#include <intrins.h>
#include "max7219.h"

#define time 10000

//u8 code sduan[16] = {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};	//π≤“ı
u8 code ddat[10][8] = {{0x18,0x18,0x3C,0x5A,0xD9,0xD9,0x18,0x18},
{0x00,0x18,0x3C,0x5A,0x5A,0x6A,0x68,0x28},
{0x00,0x18,0x3C,0x5A,0x9A,0x2E,0x2C,0x28},
{0x18,0x18,0x3C,0x5A,0x9B,0x1B,0x18,0x18},//4
{0x00,0x18,0x3C,0x5A,0x9A,0x16,0x16,0x14},
{0x00,0x18,0x3C,0x5A,0x59,0x74,0x34,0x14},
{0x18,0x18,0x3C,0x5A,0xD9,0xD8,0x18,0x18},
{0x08,0x08,0x3E,0x4D,0x76,0x74,0x14,0x00},
};
void Max7219Init(void)
{
	max7219w(0x09, 0x00);
	max7219w(0x0b, 0x07);
	max7219w(0x0a, 10); //0 - 15 ¡¡∂»
	max7219w(0x0c, 0x01);
}
void Display(u8 s)
{
	u8 i;
	for(i = 1; i < 9; i++)
	{
		max7219w(i, ddat[s][i-1]);
	}
}
void delay(u16 i)
{
	while(i--)
		_nop_();
}
void caiDisplay(void)
{
		Display(0);
		delay(time);
		Display(1);
		delay(time);
		Display(2);
		delay(time);
		Display(3);
		delay(time);
		Display(4);
		delay(time);
		Display(5);
		delay(time);
		Display(0);
		delay(time);
}
void clear()
{
	u8 y;
	for(y = 1; y<9; y++)
		{
			max7219w(y, 0x00);
		}
}
void donghua()
{
	u8 x,y,t,n;
	for(y = 1; y<9; y++)
		{
			max7219w(y, 0x00);
		}
	for(x = 0; x<4 ; x++)
	{
		t = 0x80;
		n = 0x01;
		
		for(y = 0; y<8; y++)
		{
			
			max7219w(x+1, t);
			t = t/2 + 0x80;
			max7219w(8-x, n);
			n = n*2 + 1;
			delay(1000);
		}
	}
	for(x = 0; x<4 ; x++)
	{
		t = 0xff;
		n = 0xff;
		for(y = 0; y<8; y++)
		{
			t = t<<1;
			max7219w(4-x, t);
			n = n>>1;
			max7219w(5+x, n);
			
			delay(1000);
		}
	}
}
void main(void)
{
	
	delay(1000);
	Max7219Init();
	
	while(1)
		{
			donghua();
			caiDisplay();
			caiDisplay();
			clear();
			delay(50000);
		}
}
