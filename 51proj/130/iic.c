#include "iic.h"



u8 code Font_num[10][16] = {
{0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00},
{0x00,0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00},
{0x00,0x70,0x08,0x08,0x08,0x08,0xF0,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00},
{0x00,0x30,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x18,0x20,0x21,0x21,0x22,0x1C,0x00},
{0x00,0x00,0x80,0x40,0x30,0xF8,0x00,0x00,0x00,0x06,0x05,0x24,0x24,0x3F,0x24,0x24},
{0x00,0xF8,0x88,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x20,0x20,0x20,0x11,0x0E,0x00},
{0x00,0xE0,0x10,0x88,0x88,0x90,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x20,0x1F,0x00},
{0x00,0x18,0x08,0x08,0x88,0x68,0x18,0x00,0x00,0x00,0x00,0x3E,0x01,0x00,0x00,0x00},
{0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00},
{0x00,0xF0,0x08,0x08,0x08,0x10,0xE0,0x00,0x00,0x01,0x12,0x22,0x22,0x11,0x0F,0x00},
};
u8 code lty[10][16] = {

//{0x08,0x  28,0x48,0x89,0x0E,0x88,0x78,0x08,0x08,0x00,0xF8,0x00,0x00,0xFF,0x00,0x00},
//{0x40,0x20,0x10,0x09,0x06,0x19,0x60,0x00,0x00,0x00,0x0F,0x40,0x80,0x7F,0x00,0x00},

//{0x40,0x40,0x42,0x42,0x42,0x42,0x42,0xFE,0x42,0x42,0x42,0x42,0x42,0x40,0x40,0x00},
//{0x80,0x80,0x40,0x20,0x10,0x0C,0x03,0x00,0x03,0x0C,0x10,0x20,0x40,0x80,0x80,0x00},

//{0x10,0x10,0x12,0xD2,0x56,0x5A,0x52,0x53,0x52,0x5A,0x56,0xD2,0x12,0x10,0x10,0x00},
//{0x40,0x30,0x00,0x77,0x85,0x85,0x8D,0xB5,0x85,0x85,0x85,0xE7,0x00,0x10,0x60,0x00},
	

{0x00,0xEC,0xAA,0xA9,0xA8,0xAA,0xEC,0x00,0xDF,0x24,0x24,0xA2,0xA2,0x38,0x00,0x00},
{0x80,0x6F,0x02,0x02,0x22,0xCA,0x0F,0x00,0x27,0xC9,0x09,0x08,0x28,0xCE,0x00,0x00},/*"熊",0*/
/* (16 X 16 , 宋体 )*/

{0x00,0x02,0x02,0x7A,0x4A,0x4A,0x4A,0x4A,0x7A,0x02,0x02,0x7E,0x02,0x02,0x00,0x00},
{0x01,0x01,0x01,0x3D,0x25,0x25,0x25,0x25,0x3D,0x41,0x81,0x7F,0x01,0x01,0x01,0x00},/*"哥",1*/
/* (16 X 16 , 宋体 )*/

{0x00,0x02,0x02,0x7A,0x4A,0x4A,0x4A,0x4A,0x7A,0x02,0x02,0x7E,0x02,0x02,0x00,0x00},
{0x01,0x01,0x01,0x3D,0x25,0x25,0x25,0x25,0x3D,0x41,0x81,0x7F,0x01,0x01,0x01,0x00},/*"哥",2*/
/* (16 X 16 , 宋体 )*/

{0x08,0x38,0xC8,0x00,0xC8,0x38,0x08,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00},

{0x08,0x38,0xC8,0x00,0xC8,0x38,0x08,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00},

{0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00,0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00},

{0x00,0x70,0x88,0x08,0x08,0x08,0x38,0x00,0x00,0x38,0x20,0x21,0x21,0x22,0x1C,0x00},
};
u8 bdata Buffer;
sbit buffb0 = Buffer^0;
sbit buffb1 = Buffer^1;
sbit buffb2 = Buffer^2;
sbit buffb3 = Buffer^3;
sbit buffb4 = Buffer^4;
sbit buffb5 = Buffer^5;
sbit buffb6 = Buffer^6;
sbit buffb7 = Buffer^7;
void IIC_Start()
{
	SDA = 1;
	SCL = 1;
	SDA = 0;
}
void IIC_Stop()
{
	SDA = 0;
	SCL = 1;
	SDA = 1;
}
void IIC_Send(u8 dat)
{
	Buffer = dat;
	SCL = 0;
	SDA = buffb7;
	SCL = 1;
	SCL = 0;
	SDA = buffb6;
	SCL = 1;
	SCL = 0;
	SDA = buffb5;
	SCL = 1;
	SCL = 0;
	SDA = buffb4;
	SCL = 1;
	SCL = 0;
	SDA = buffb3;
	SCL = 1;
	SCL = 0;
	SDA = buffb2;
	SCL = 1;
	SCL = 0;
	SDA = buffb1;
	SCL = 1;
	SCL = 0;
	SDA = buffb0;
	SCL = 1;
	
	//ack
	SCL = 0;
	SDA = 1;
	SCL = 1;
	SCL = 0;
}
void SSD1306_WriteCMD(u8 CMD)
{
	IIC_Start();
	IIC_Send(IIC_Addr);
	IIC_Send(0x00);
	IIC_Send(CMD);
	IIC_Stop();
}
void SSD1306_WriteDATA(u8 *dat, u16 count)
{
	IIC_Start();
	IIC_Send(IIC_Addr);
	IIC_Send(0x40);
	while(count--)
	{
		IIC_Send(*dat);
		dat++;
	}
}
void SSD1306_Init()
{
	SSD1306_WriteCMD(0xA8);
	SSD1306_WriteCMD(0x3F);
	SSD1306_WriteCMD(0xD3);
	SSD1306_WriteCMD(0x00);
	SSD1306_WriteCMD(0x40);
	SSD1306_WriteCMD(0xA1); //com
	SSD1306_WriteCMD(0xc8); //
	SSD1306_WriteCMD(0xDA);
	SSD1306_WriteCMD(0x12);
	
	SSD1306_WriteCMD(0x81);
	SSD1306_WriteCMD(0x7f);
	SSD1306_WriteCMD(0xa4);
	SSD1306_WriteCMD(0xa6);
	
	SSD1306_WriteCMD(0xd5);
	SSD1306_WriteCMD(0x80);
	
	SSD1306_WriteCMD(0x8d);
	SSD1306_WriteCMD(0x14);
	SSD1306_WriteCMD(0xaf);
	
	SSD1306_WriteCMD(0xd9);
	SSD1306_WriteCMD(0x22);
	
	
	SSD1306_WriteCMD(0x81);
	SSD1306_WriteCMD(0xff);
	
	//水平寻址模式
	SSD1306_WriteCMD(0x20);
	SSD1306_WriteCMD(0x00);
	
	
//	SSD1306_WriteCMD(0xa5); // 全亮
}

void SSD1306_SetPageAddr(u8 StartAddr, u8 EndAddr)
{
	SSD1306_WriteCMD(0x22);
	SSD1306_WriteCMD(StartAddr & 0x07);
	SSD1306_WriteCMD(EndAddr & 0x07);
}

void SSD1306_SetColAddr(u8 StartAddr, u8 EndAddr)
{
	SSD1306_WriteCMD(0x21);
	SSD1306_WriteCMD(StartAddr & 0x7f);
	SSD1306_WriteCMD(EndAddr & 0x7f);
}
void SSD1306_Clear()
{
	u16 i = 1024;
	SSD1306_SetPageAddr(0, 7);
	SSD1306_SetColAddr(0, 127);
	IIC_Start();
	IIC_Send(IIC_Addr);
	IIC_Send(0x40);
	while(i--)
	{
		IIC_Send(0x00);
	}
	IIC_Stop();
}
void SSD1306_SetPos(u8 x, u8 y)
{
	SSD1306_SetPageAddr(y, 7);
	SSD1306_SetColAddr(x * 8, 127);
}

void SSD1306_DrawCh(u8 ch, u8 x, u8 y)
{
	SSD1306_SetPos(x , y*2);
	if(ch >= '0' && ch <= '9')
	{
		ch = ch - '0';
		SSD1306_SetPageAddr(y*2, y*2);
		SSD1306_SetColAddr(x * 8, x * 8 + 7);
		SSD1306_WriteDATA(Font_num[ch], 8);
		SSD1306_SetPageAddr(y*2 + 1, y*2 + 1);
		SSD1306_SetColAddr(x * 8, x * 8 + 7);
		SSD1306_WriteDATA(Font_num[ch] + 8, 8);
	}
	
}
void SSD1306_SetCon(u8 Contrast)
{
	SSD1306_WriteCMD(0x81);
	SSD1306_WriteCMD(Contrast);
}

void ltyd()
{
	SSD1306_SetPos(0, 0);
	SSD1306_WriteDATA(lty[0], 16);
	SSD1306_SetPos(0, 1);
	SSD1306_WriteDATA(lty[1], 16);
	SSD1306_SetPos(0, 2);
	SSD1306_WriteDATA(lty[0], 16);
	SSD1306_SetPos(0, 3);
	SSD1306_WriteDATA(lty[1], 16);
	SSD1306_SetPos(0, 4);
	SSD1306_WriteDATA(lty[0], 16);
	SSD1306_SetPos(0, 5);
	SSD1306_WriteDATA(lty[1], 16);
	SSD1306_SetPos(0, 6);
	SSD1306_WriteDATA(lty[0], 16);
	SSD1306_SetPos(0, 7);
	SSD1306_WriteDATA(lty[1], 16);
	
	SSD1306_SetPos(2, 0);
	SSD1306_WriteDATA(lty[2], 16);
	SSD1306_SetPos(2, 1);
	SSD1306_WriteDATA(lty[3], 16);
	SSD1306_SetPos(2, 2);
	SSD1306_WriteDATA(lty[2], 16);
	SSD1306_SetPos(2, 3);
	SSD1306_WriteDATA(lty[3], 16);
	SSD1306_SetPos(2, 4);
	SSD1306_WriteDATA(lty[2], 16);
	SSD1306_SetPos(2, 5);
	SSD1306_WriteDATA(lty[3], 16);
	SSD1306_SetPos(2, 6);
	SSD1306_WriteDATA(lty[2], 16);
	SSD1306_SetPos(2, 7);
	SSD1306_WriteDATA(lty[3], 16);
	
	SSD1306_SetPos(4, 0);
	SSD1306_WriteDATA(lty[4], 16);
	SSD1306_SetPos(4, 1);
	SSD1306_WriteDATA(lty[5], 16);
	SSD1306_SetPos(4, 2);
	SSD1306_WriteDATA(lty[4], 16);
	SSD1306_SetPos(4, 3);
	SSD1306_WriteDATA(lty[5], 16);
	SSD1306_SetPos(4, 4);
	SSD1306_WriteDATA(lty[4], 16);
	SSD1306_SetPos(4, 5);
	SSD1306_WriteDATA(lty[5], 16);
	SSD1306_SetPos(4, 6);
	SSD1306_WriteDATA(lty[4], 16);
	SSD1306_SetPos(4, 7);
	SSD1306_WriteDATA(lty[5], 16);
	
	SSD1306_SetPos(6, 0);
	SSD1306_WriteDATA(lty[6], 8);
	SSD1306_SetPos(6, 1);
	SSD1306_WriteDATA(lty[6] +8, 8);
	SSD1306_SetPos(6, 2);
	SSD1306_WriteDATA(lty[6], 8);
	SSD1306_SetPos(6, 3);
	SSD1306_WriteDATA(lty[6] +8, 8);
	SSD1306_SetPos(6, 4);
	SSD1306_WriteDATA(lty[6], 8);
	SSD1306_SetPos(6, 5);
	SSD1306_WriteDATA(lty[6] +8, 8);
	SSD1306_SetPos(6, 6);
	SSD1306_WriteDATA(lty[6], 8);
	SSD1306_SetPos(6, 7);
	SSD1306_WriteDATA(lty[6] +8, 8);
	
	SSD1306_SetPos(7, 0);
	SSD1306_WriteDATA(lty[7], 8);
	SSD1306_SetPos(7, 1);
	SSD1306_WriteDATA(lty[7] +8, 8);
	SSD1306_SetPos(7, 2);
	SSD1306_WriteDATA(lty[7], 8);
	SSD1306_SetPos(7, 3);
	SSD1306_WriteDATA(lty[7] +8, 8);
	SSD1306_SetPos(7, 4);
	SSD1306_WriteDATA(lty[7], 8);
	SSD1306_SetPos(7, 5);
	SSD1306_WriteDATA(lty[7] +8, 8);
	SSD1306_SetPos(7, 6);
	SSD1306_WriteDATA(lty[7], 8);
	SSD1306_SetPos(7, 7);
	SSD1306_WriteDATA(lty[7] +8, 8);
	
	SSD1306_SetPos(8, 0);
	SSD1306_WriteDATA(lty[8], 8);
	SSD1306_SetPos(8, 1);
	SSD1306_WriteDATA(lty[8] +8, 8);
	SSD1306_SetPos(8, 2);
	SSD1306_WriteDATA(lty[8], 8);
	SSD1306_SetPos(8, 3);
	SSD1306_WriteDATA(lty[8] +8, 8);
	SSD1306_SetPos(8, 4);
	SSD1306_WriteDATA(lty[8], 8);
	SSD1306_SetPos(8, 5);
	SSD1306_WriteDATA(lty[8] +8, 8);
	SSD1306_SetPos(8, 6);
	SSD1306_WriteDATA(lty[8], 8);
	SSD1306_SetPos(8, 7);
	SSD1306_WriteDATA(lty[8] +8, 8);
	
	SSD1306_SetPos(9, 0);
	SSD1306_WriteDATA(lty[9], 8);
	SSD1306_SetPos(9, 1);
	SSD1306_WriteDATA(lty[9] +8, 8);
	SSD1306_SetPos(9, 2);
	SSD1306_WriteDATA(lty[9], 8);
	SSD1306_SetPos(9, 3);
	SSD1306_WriteDATA(lty[9] +8, 8);
	SSD1306_SetPos(9, 4);
	SSD1306_WriteDATA(lty[9], 8);
	SSD1306_SetPos(9, 5);
	SSD1306_WriteDATA(lty[9] +8, 8);
	SSD1306_SetPos(9, 6);
	SSD1306_WriteDATA(lty[9], 8);
	SSD1306_SetPos(9, 7);
	SSD1306_WriteDATA(lty[9] +8, 8);
	
}


